-- LocalScript w StarterGui
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

-- ===== Helper =====
local function refreshChar()
    char = player.Character or player.CharacterAdded:Wait()
    hrp = char:WaitForChild("HumanoidRootPart")
    humanoid = char:WaitForChild("Humanoid")
end
player.CharacterAdded:Connect(function() wait(0.2) refreshChar() end)

-- ===== GUI =====
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "HaGui"
screenGui.ResetOnSpawn = false

local toggleBtn = Instance.new("TextButton", screenGui)
toggleBtn.Size = UDim2.new(0,140,0,30)
toggleBtn.Position = UDim2.new(0.02,0,0.02,0)
toggleBtn.Text = "Open HaGui"
toggleBtn.Font = Enum.Font.SourceSansBold
toggleBtn.TextSize = 18
toggleBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0,320,0,400)
frame.Position = UDim2.new(0.05,0,0.1,0)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.BorderSizePixel = 0
frame.Visible = false
frame.AnchorPoint = Vector2.new(0,0)
frame.ZIndex = 2

-- Top bar
local topBar = Instance.new("Frame", frame)
topBar.Size = UDim2.new(1,0,0,30)
topBar.BackgroundColor3 = Color3.fromRGB(255,0,0)
local gradient = Instance.new("UIGradient", topBar)
gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255,50,50)), ColorSequenceKeypoint.new(1, Color3.fromRGB(200,0,0))})

local title = Instance.new("TextLabel", topBar)
title.Size = UDim2.new(1,0,1,0)
title.BackgroundTransparency = 1
title.Text = "ha ha ha ha ha"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 18
title.TextColor3 = Color3.fromRGB(255,255,255)

-- ScrollFrame
local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(1,0,1,-40)
scroll.Position = UDim2.new(0,0,0,30)
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 8
scroll.BackgroundTransparency = 1
local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0,6)

-- ===== Movable GUI =====
local dragging=false
local dragInput, mousePos, framePos
topBar.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        mousePos=input.Position
        framePos=frame.Position
        input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.End then dragging=false end
        end)
    end
end)
topBar.InputChanged:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseMovement then dragInput=input end
end)
UserInputService.InputChanged:Connect(function(input)
    if input==dragInput and dragging then
        local delta=input.Position - mousePos
        frame.Position=UDim2.new(framePos.X.Scale,framePos.X.Offset+delta.X, framePos.Y.Scale, framePos.Y.Offset+delta.Y)
    end
end)

toggleBtn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)

-- ===== Button helper =====
local function createButton(name, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.95,0,0,36)
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.BorderSizePixel = 0
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.Parent = scroll
    local grad = Instance.new("UIGradient", btn)
    grad.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(80,0,0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(150,0,0))})
    grad.Rotation = 45
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(120,0,0)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(50,50,50)}):Play()
    end)
    btn.MouseButton1Click:Connect(callback)
end

-- ===== Fly =====
local flyActive=false
local flyBV=nil
local moveVec=Vector3.new(0,0,0)
local FLY_SPEED=120

local function enableFly()
    if not hrp then return end
    flyBV=Instance.new("BodyVelocity")
    flyBV.MaxForce=Vector3.new(1e5,1e5,1e5)
    flyBV.Velocity=Vector3.new(0,0,0)
    flyBV.Parent=hrp
    flyActive=true
end
local function disableFly()
    if flyBV then flyBV:Destroy() end
    flyBV=nil
    flyActive=false
end

UserInputService.InputBegan:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode==Enum.KeyCode.W then moveVec=moveVec+Vector3.new(0,0,-1) end
    if input.KeyCode==Enum.KeyCode.S then moveVec=moveVec+Vector3.new(0,0,1) end
    if input.KeyCode==Enum.KeyCode.A then moveVec=moveVec+Vector3.new(-1,0,0) end
    if input.KeyCode==Enum.KeyCode.D then moveVec=moveVec+Vector3.new(1,0,0) end
    if input.KeyCode==Enum.KeyCode.Space then moveVec=moveVec+Vector3.new(0,1,0) end
    if input.KeyCode==Enum.KeyCode.LeftShift then moveVec=moveVec+Vector3.new(0,-1,0) end
end)
UserInputService.InputEnded:Connect(function(input,gp)
    if gp then return end
    if input.KeyCode==Enum.KeyCode.W then moveVec=moveVec-Vector3.new(0,0,-1) end
    if input.KeyCode==Enum.KeyCode.S then moveVec=moveVec-Vector3.new(0,0,1) end
    if input.KeyCode==Enum.KeyCode.A then moveVec=moveVec-Vector3.new(-1,0,0) end
    if input.KeyCode==Enum.KeyCode.D then moveVec=moveVec-Vector3.new(1,0,0) end
    if input.KeyCode==Enum.KeyCode.Space then moveVec=moveVec-Vector3.new(0,1,0) end
    if input.KeyCode==Enum.KeyCode.LeftShift then moveVec=moveVec-Vector3.new(0,-1,0) end
end)

RunService.RenderStepped:Connect(function()
    if flyActive and flyBV and hrp then
        local cam = workspace.CurrentCamera
        local dir = (cam.CFrame.LookVector*moveVec.Z + cam.CFrame.RightVector*moveVec.X + Vector3.new(0,1,0)*moveVec.Y)
        if dir.Magnitude>0 then
            flyBV.Velocity = dir.Unit*FLY_SPEED
        else
            flyBV.Velocity = Vector3.new(0,0,0)
        end
    end
end)

-- ===== Buttons =====
createButton("Fly ON/OFF", function()
    if flyActive then disableFly() else enableFly() end
end)

local noclipActive=false
createButton("Noclip ON/OFF", function()
    refreshChar()
    for _,p in ipairs(char:GetDescendants()) do
        if p:IsA("BasePart") then p.CanCollide = not noclipActive end
    end
    noclipActive = not noclipActive
end)

local speedActive=false
createButton("Speed 100 ON/OFF", function()
    refreshChar()
    if humanoid then
        if speedActive then humanoid.WalkSpeed = 16 else humanoid.WalkSpeed = 100 end
        speedActive = not speedActive
    end
end)

-- ESP
local espActive=false
local espFolder=Instance.new("Folder", workspace)
espFolder.Name="HaESP"
local function createESP(plr)
    if not plr.Character then return end
    local hrp2 = plr.Character:FindFirstChild("HumanoidRootPart") or plr.Character.PrimaryPart
    if not hrp2 then return end
    if hrp2:FindFirstChild("HaESPBillboard") then return end
    local bb = Instance.new("BillboardGui")
    bb.Name = "HaESPBillboard"
    bb.Adornee = hrp2
    bb.Size = UDim2.new(0,100,0,40)
    bb.StudsOffset = Vector3.new(0,2.5,0)
    bb.AlwaysOnTop = true
    bb.Parent = espFolder
    local label = Instance.new("TextLabel", bb)
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.Text = plr.Name
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.TextColor3 = Color3.new(1,0,0)
end
local function clearESP()
    for _,v in ipairs(espFolder:GetChildren()) do v:Destroy() end
end
createButton("ESP ON/OFF", function()
    espActive = not espActive
    if espActive then
        for _,pl in ipairs(Players:GetPlayers()) do
            if pl ~= player then createESP(pl) end
        end
        Players.PlayerAdded:Connect(function(pl)
            pl.CharacterAdded:Connect(function()
                if espActive then createESP(pl) end
            end)
        end)
    else
        clearESP()
    end
end)

-- ===== Teleport do losowego gracza =====
createButton("Teleport to Random Player", function()
    local others = {}
    for _,pl in ipairs(Players:GetPlayers()) do
        if pl ~= player and pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") then
            table.insert(others, pl)
        end
    end
    if #others == 0 then
        print("Brak graczy")
        return
    end
    local target = others[math.random(1,#others)]
    hrp.CFrame = target.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
    print("TepniÄ™to do: "..target.Name)
end)
