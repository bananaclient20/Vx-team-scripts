-- LocalScript w StarterGui
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- ===== Character helper =====
local char, hrp, humanoid
local function refreshChar()
    char = player.Character or player.CharacterAdded:Wait()
    hrp = char:WaitForChild("HumanoidRootPart")
    humanoid = char:WaitForChild("Humanoid")
end
refreshChar()
player.CharacterAdded:Connect(refreshChar)

-- ===== GUI =====
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SimpleHaGui"
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Toggle Button
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0,140,0,30)
toggleBtn.Position = UDim2.new(0.02,0,0.02,0)
toggleBtn.Text = "Open GUI"
toggleBtn.Parent = screenGui

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,250,0,300)
frame.Position = UDim2.new(0.1,0,0.1,0)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.Visible = false
frame.Parent = screenGui

-- Movable
local dragging=false
local dragInput, mousePos, framePos
frame.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseButton1 then
        dragging=true
        mousePos=input.Position
        framePos=frame.Position
        input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.End then dragging=false end
        end)
    end
end)
frame.InputChanged:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseMovement then dragInput=input end
end)
UserInputService.InputChanged:Connect(function(input)
    if input==dragInput and dragging then
        local delta = input.Position - mousePos
        frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset+delta.X, framePos.Y.Scale, framePos.Y.Offset+delta.Y)
    end
end)

toggleBtn.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)

-- ===== Buttons =====
local function createButton(name, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.9,0,0,30)
    btn.Position = UDim2.new(0.05,0,0,#frame:GetChildren()*0.1)
    btn.Text = name
    btn.Parent = frame
    btn.MouseButton1Click:Connect(callback)
end

-- ===== Fly =====
local flyActive=false
local flySpeed=100
local flyBV=nil
local moveVec=Vector3.new(0,0,0)

createButton("Fly ON/OFF", function()
    if flyActive then
        if flyBV then flyBV:Destroy() end
        flyBV=nil
        flyActive=false
    else
        flyBV=Instance.new("BodyVelocity")
        flyBV.MaxForce=Vector3.new(1e5,1e5,1e5)
        flyBV.Velocity=Vector3.new(0,0,0)
        flyBV.Parent = hrp
        flyActive=true
    end
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode==Enum.KeyCode.W then moveVec=moveVec+Vector3.new(0,0,-1) end
    if input.KeyCode==Enum.KeyCode.S then moveVec=moveVec+Vector3.new(0,0,1) end
    if input.KeyCode==Enum.KeyCode.A then moveVec=moveVec+Vector3.new(-1,0,0) end
    if input.KeyCode==Enum.KeyCode.D then moveVec=moveVec+Vector3.new(1,0,0) end
    if input.KeyCode==Enum.KeyCode.Space then moveVec=moveVec+Vector3.new(0,1,0) end
    if input.KeyCode==Enum.KeyCode.LeftShift then moveVec=moveVec+Vector3.new(0,-1,0) end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode==Enum.KeyCode.W then moveVec=moveVec-Vector3.new(0,0,-1) end
    if input.KeyCode==Enum.KeyCode.S then moveVec=moveVec-Vector3.new(0,0,1) end
    if input.KeyCode==Enum.KeyCode.A then moveVec=moveVec-Vector3.new(-1,0,0) end
    if input.KeyCode==Enum.KeyCode.D then moveVec=moveVec-Vector3.new(1,0,0) end
    if input.KeyCode==Enum.KeyCode.Space then moveVec=moveVec-Vector3.new(0,1,0) end
    if input.KeyCode==Enum.KeyCode.LeftShift then moveVec=moveVec-Vector3.new(0,-1,0) end
end)

RunService.RenderStepped:Connect(function()
    if flyActive and flyBV then
        local cam = workspace.CurrentCamera
        local dir = (cam.CFrame.LookVector*moveVec.Z + cam.CFrame.RightVector*moveVec.X + Vector3.new(0,1,0)*moveVec.Y)
        if dir.Magnitude>0 then
            flyBV.Velocity = dir.Unit*flySpeed
        else
            flyBV.Velocity = Vector3.new(0,0,0)
        end
    end
end)

-- ===== Speed =====
local speedActive=false
createButton("Speed 100 ON/OFF", function()
    if speedActive then
        humanoid.WalkSpeed = 16
        speedActive=false
    else
        humanoid.WalkSpeed = 100
        speedActive=true
    end
end)

-- ===== Noclip =====
local noclipActive=false
createButton("Noclip ON/OFF", function()
    for _,p in ipairs(char:GetDescendants()) do
        if p:IsA("BasePart") then p.CanCollide = noclipActive end
    end
    noclipActive = not noclipActive
end)

-- ===== Teleport do losowego gracza =====
createButton("Teleport to Random Player", function()
    local others={}
    for _,pl in ipairs(Players:GetPlayers()) do
        if pl~=player and pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") then
            table.insert(others,pl)
        end
    end
    if #others>0 then
        local target = others[math.random(1,#others)]
        hrp.CFrame = target.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
    end
end)
